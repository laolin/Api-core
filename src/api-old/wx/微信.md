消息模块设计
============
*2016-11-26 15:05 *



1. 实现的功能
    #### 所有向用户推送的消息记录
    #### 用户阅读消息情况
    #### 支持实现OA事件处理
1. 数据库
    1. 表名
        #### g_message
    2. 使用者
        #### 所有模块
    3. 字段SQL
           drop table if exists `g_message`;
           create table if not exists `g_message` 
           (
             `id`             int(11)  not null auto_increment ,
             `module`         varchar( 32) DEFAULT ''  COMMENT  '所属模块'
             `type`           varchar( 32) DEFAULT ''  COMMENT  '消息类型'
             `userid`         varchar( 32) DEFAULT ''  COMMENT  '发送给的用户'
             `target_url`     varchar( 32) DEFAULT ''  COMMENT  '目标页面'
             `t_create`       varchar( 32) DEFAULT ''  COMMENT  '生成时间'
             `t_send_b`       varchar( 32) DEFAULT ''  COMMENT  '计划开始发送时间，空白表示请求马上发送'
             `t_send_e`       varchar( 32) DEFAULT ''  COMMENT  '计划结束发送时间，超过此时间后，将作废。空白表示不被作废'
             `t_send`         varchar( 32) DEFAULT ''  COMMENT  '发送时间'
             `t_read`         varchar( 32) DEFAULT ''  COMMENT  '阅读时间'
             `t_done`         varchar( 32) DEFAULT ''  COMMENT  '完成时间'
             `t_delete`       varchar( 32) DEFAULT ''  COMMENT  '删除时间'
             `attr`           text                     COMMENT  '各种内容，json格式',
             primary key (`id`),
             unique key `id` (`id`),
             key `module` (`module`),
             key `type` (`type`),
             key `userid` (`userid`)
           )default charset=utf8;
1. 类库
    1. 说明
        #### 不提供共用文件，以便部分升级或定制
        #### 各个模块自行复制 php 类
    1. SDK
           <?php
           class CMessage{
             function __construct($module, $db, $tableName = "g_message");
             //插入新的消息
             public function insert($text, $userid = "", $type = "", $target_url = "");
             //获取一行
             public function getRow($AND, $fields = false);
             //获取多行（列表）
             public function getList($AND, $fields = false);
             //获取待发送消息列表
             public function getToSendList($AND, $fields = false);
             //获取我的未读消息列表
             public function getMyUnreadedList($userid, $fields = false);
             //获取我的未读消息列表
             public function getMyReadedList($userid, $fields = false);
             //标志消息为已读
             public function markReaded($id);
             //标志消息为未读
             public function markUnReaded($id);
             //标志消息为已完成
             public function markDone($id);
             //标志消息为未完成
             public function markUnDone($id);
             //标志消息为已删除
             public function markDone($id);
             //标志消息为未删除
             public function markUnDone($id);
           }
    1. 说明



<style><span class="ui-helper-hidden">{}  li{list-style-type:none;margin:0.5em 0 0.2em 0!important; line-height:1;font-size:0.9em;font-weight:500;} li h1,li h2,li h3,li h4,li h5,li>p:not(:first-child){font-size:14px;font-weight:500; line-height:1.33;margin:0.2em 0 0.2em 2em!important;color:#555;} li>p:first-child{display: inline;} body{counter-reset:h1;} body>ol>li{counter-reset:h2; font-size:26px;color:#00f; font-weight:900;} body>ol>li>ol>li{counter-reset:h3; color:#008;} body>ol>li>ol>li>ol>li{counter-reset:h4; color:#338;} body>ol>li>ol>li>ol>li>ol>li{counter-reset:h5; color:#558;} body>ol>li>ol>li>ol>li>ol>li>ol>li{counter-reset:h6; color:#555;} body>ol>li:before{ counter-increment:h1; content:counter(h1) ". ";} body>ol>li>ol>li:before{ counter-increment:h2; content:counter(h1) "." counter(h2) " ";} body>ol>li>ol>li>ol>li:before{ counter-increment:h3; content:counter(h1) "." counter(h2) "." counter(h3) " ";} body>ol>li>ol>li>ol>li>ol>li:before{ counter-increment:h4; content:counter(h1) "." counter(h2) "." counter(h3) "." counter(h4) " ";} body>ol>li>ol>li>ol>li>ol>li>ol>li:before{ counter-increment:h5; content:counter(h1) "." counter(h2) "." counter(h3) "." counter(h4) "." counter(h5) " ";}</span></style>




